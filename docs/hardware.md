# 硬件设计文档

## 系统架构概览

Poopal硬件系统采用模块化设计，主要包含以下核心组件：

### 主控制单元
- **微控制器**：ESP32-S3 (双核240MHz，支持WiFi和蓝牙)
- **AI处理器**：集成神经网络处理单元(NPU)，专门优化计算机视觉任务
- **内存配置**：512KB SRAM，8MB Flash存储，2MB PSRAM用于图像处理
- **扩展接口**：GPIO、I2C、SPI、UART、CSI摄像头接口
- **电源管理**：集成充电管理芯片，支持USB-C充电

### 视觉检测模块

#### 1. 高清摄像头系统
- **主摄像头**：1080P@30fps，1/2.8"CMOS传感器
- **镜头规格**：120°广角镜头，F2.0大光圈，自动对焦
- **图像质量**：自动曝光(AE)、自动白平衡(AWB)、3D降噪
- **夜视功能**：940nm红外补光灯，夜间监控距离3-5米
- **防护设计**：IP65防水等级，防宠物撕咬涂层

#### 2. 图像信号处理器(ISP)
- **实时处理**：硬件级图像增强，支持HDR、WDR
- **降噪优化**：3D降噪算法，暗光环境图像质量提升
- **畸变校正**：广角镜头畸变自动校正
- **ROI优化**：感兴趣区域重点处理，提高检测精度

#### 3. AI视觉处理单元
- **NPU性能**：0.8 TOPS算力，专门优化YOLOv8检测算法
- **模型支持**：支持TensorFlow Lite、ONNX模型格式
- **实时推理**：检测延迟<50ms，支持多目标同时检测
- **模型更新**：支持OTA模型更新，持续优化检测精度

### 传感器阵列

#### 1. PIR运动检测阵列
- **型号**：4×PIR传感器矩阵布局
- **检测范围**：水平120°，垂直90°，检测距离0.5-5米
- **响应时间**：<100ms
- **工作温度**：-10°C ~ +60°C
- **智能联动**：PIR触发摄像头激活，节省功耗

#### 2. 重量传感器系统
- **类型**：四角分布应变式称重传感器
- **量程**：0-50kg，适应各种体型宠物
- **精度**：±10g高精度检测
- **响应时间**：<50ms实时响应
- **防护等级**：IP65防水防尘

#### 3. 环境光传感器
- **检测范围**：0.1-65535 lux
- **自适应功能**：根据环境光自动调节补光强度
- **节能控制**：光线充足时自动关闭红外补光
- **色温检测**：支持色温检测，优化白平衡

#### 4. 气味检测传感器
- **检测类型**：氨气、硫化氢等排便相关气体
- **检测范围**：0.1-1000ppm
- **响应时间**：<30s
- **数据融合**：与视觉检测结合，提高判断准确性

### 执行器模块

#### 1. 智能投食器
- **投放机构**：42步进电机驱动螺旋结构
- **容量**：500ml零食储存仓，透明可视设计
- **投放精度**：1-5颗/次精确控制
- **材质**：食品级PC+ABS塑料，抗菌涂层
- **检测功能**：光电传感器检测投放状态

#### 2. 高保真音频系统
- **功放芯片**：TAS2770数字功放，THD<0.01%
- **扬声器**：5W全频钕磁喇叭，频响20Hz-20kHz
- **音频格式**：支持MP3、AAC、WAV、FLAC格式
- **音量控制**：256级精细音量调节，0-85dB可调
- **降噪设计**：ANC主动降噪，减少环境干扰

#### 3. 智能LED指示系统
- **LED类型**：WS2812B可编程RGB LED
- **数量配置**：24颗环形排列+4颗状态指示
- **控制精度**：16777216色彩空间，256级亮度
- **显示模式**：呼吸灯、流水灯、闪烁等多种模式
- **节能设计**：智能亮度调节，延长电池寿命

### 通信与连接

#### 1. 无线通信模块
- **WiFi**：802.11 b/g/n，2.4GHz，支持WPA3安全协议
- **蓝牙**：BLE 5.2，低功耗连接，最大传输距离30米
- **云端协议**：MQTT over TLS，确保数据传输安全
- **本地通信**：ESP-NOW点对点通信，设备间直连

#### 2. 存储系统
- **本地存储**：8MB Flash + 64GB可选TF卡扩展
- **数据缓存**：7天本地行为数据缓存
- **固件分区**：双分区设计，支持安全OTA更新
- **数据加密**：AES-256硬件加密，保护用户数据

### 电源与充电系统

#### 1. 电池系统
- **电池类型**：18650锂电池 3500mAh，可拆卸设计
- **备用电池**：支持双电池设计，热插拔更换
- **电池保护**：过充、过放、短路、过温多重保护
- **续航时间**：正常使用30-45天，连续监控7-10天

#### 2. 智能充电系统
- **充电接口**：USB-C PD快充，最大功率18W
- **充电时间**：2-3小时充满，支持边充边用
- **充电指示**：LED状态指示，App实时电量显示
- **节能模式**：智能休眠，PIR唤醒，降低功耗60%

### 外壳与机械设计

#### 1. 外壳材料
- **主体材质**：PC+ABS阻燃工程塑料
- **表面处理**：抗菌UV涂层，防止细菌滋生
- **防护等级**：IP54防尘防水，适应宠物环境
- **抗咬设计**：硬化表面处理，耐宠物啃咬

#### 2. 尺寸与重量
- **设备尺寸**：220mm×180mm×90mm
- **设备重量**：750g（含电池）
- **检测范围**：半径2米圆形区域，高度0.8米
- **安装高度**：推荐离地15-20cm安装

#### 3. 散热设计
- **被动散热**：铝合金散热片+导热硅脂
- **主动散热**：温控风扇，35°C自动启动
- **温度监控**：实时温度检测，过热保护
- **通风设计**：侧面通风孔，保证空气流通

## 电路系统设计

### 主板电路架构

```
[ESP32-S3主控] ──┬── [摄像头CSI接口] ── [1080P摄像头]
                 ├── [PIR传感器阵列] ── I2C总线
                 ├── [重量传感器] ────── ADC接口  
                 ├── [环境光传感器] ──── I2C总线
                 ├── [气味传感器] ────── UART接口
                 ├── [步进电机驱动] ──── GPIO控制
                 ├── [音频功放] ──────── I2S接口
                 ├── [LED控制器] ────── SPI接口
                 ├── [红外补光灯] ────── PWM控制
                 └── [电源管理单元] ──── 专用电源线路
```

### 电源分配系统

| 模块 | 电压 | 电流 | 功耗 |
|------|------|------|------|
| ESP32-S3主控 | 3.3V | 500mA | 1.65W |
| 摄像头模块 | 3.3V | 300mA | 1.0W |
| PIR传感器阵列 | 3.3V | 50mA | 0.165W |
| 重量传感器 | 5V | 100mA | 0.5W |
| 音频功放 | 5V | 1A | 5W |
| LED系统 | 5V | 200mA | 1W |
| 步进电机 | 12V | 500mA | 6W |
| **总计** | - | - | **15.3W** |

## 安装与部署

### 环境要求
- **工作温度**：-10°C ~ +50°C
- **存储温度**：-20°C ~ +70°C
- **工作湿度**：10% ~ 90% RH（无凝露）
- **大气压力**：86kPa ~ 106kPa

### 安装规范

#### 1. 位置选择
- **平整度要求**：安装面倾斜度<5°
- **光线环境**：避免强光直射，确保适中光线
- **网络覆盖**：WiFi信号强度≥-70dBm
- **电源距离**：距离电源插座≤2米

#### 2. 安装步骤
1. **基础准备**：清理安装区域，确保平整干净
2. **设备定位**：按照检测范围标记设备位置
3. **电源连接**：连接电源适配器，检查供电状态
4. **网络配置**：通过App完成WiFi配网
5. **功能测试**：依次测试各模块功能是否正常

### 维护保养

#### 1. 日常维护
- **外观清洁**：每周用干净湿布擦拭外壳
- **镜头清洁**：每周用镜头纸清洁摄像头
- **传感器检查**：每月检查传感器工作状态
- **软件更新**：及时安装固件和App更新

#### 2. 定期保养
- **深度清洁**：每季度进行一次全面清洁
- **传感器校准**：每半年进行一次传感器校准
- **电池维护**：定期检查电池状态和充电效果
- **专业检测**：每年进行一次专业维护检测

## 扩展与升级

### 硬件扩展接口
- **USB-C接口**：调试、数据传输、固件更新
- **GPIO扩展**：8个可编程GPIO，支持自定义传感器
- **I2C总线**：扩展传感器模块连接
- **SPI接口**：高速数据传输，扩展存储
- **UART接口**：串口通信，设备间数据交换

### 可选扩展模块
- **户外模块**：太阳能充电板+防水外壳
- **多宠物模块**：增强识别算法，支持多宠物同时监控
- **健康监测模块**：心率、体温等生理参数检测
- **智能门禁模块**：自动开关门，配合训练使用

### 升级路径
- **算法升级**：定期推送AI模型更新
- **功能升级**：通过OTA添加新功能
- **硬件升级**：模块化设计支持硬件组件升级
- **生态扩展**：接入智能家居生态系统

## 质量与认证

### 产品认证
- **安全认证**：CE、FCC、RoHS认证
- **质量标准**：ISO 9001质量管理体系
- **环保标准**：WEEE电子废物回收指令
- **无线认证**：WiFi联盟、蓝牙SIG认证

### 测试标准
- **环境测试**：高低温、湿热、振动、跌落测试
- **电磁兼容**：EMC电磁干扰和抗干扰测试
- **安全测试**：电气安全、材料安全、结构安全
- **性能测试**：功能性能、稳定性、可靠性测试

### 质量保证
- **出厂检测**：100%产品出厂前功能检测
- **批次追溯**：完整的生产批次追溯系统
- **售后服务**：2年质保+终身技术支持
- **持续改进**：基于用户反馈持续产品优化
